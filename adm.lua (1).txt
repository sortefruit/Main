local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TextChatService = game:GetService("TextChatService")
local RunService = game:GetService("RunService")

local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

getgenv().ScriptID = "MeuScriptUnico" 
local allowedUsers = {
    ["scout7ixs"] = true,
}

local selectedPlayer = nil
local JailObjects = {}
local FrozenPlayers = {}
local sharinganRunning = false -- Variável para controlar execução do Sharingan
local gravityDisabled = {}
local clonedPlayers = {}
local glitchActive = {}
local shapeshiftActive = {}

-- Função de teleporte com tween
function topos(Pos)
    local humanoidRootPart = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then return end
    
    local Distance = (Pos.Position - humanoidRootPart.Position).Magnitude

    if LocalPlayer.Character.Humanoid.Sit then
        LocalPlayer.Character.Humanoid.Sit = false
    end

    local tweenSpeed = 50 -- Velocidade do tween
    local tweenInfo = TweenInfo.new(Distance / tweenSpeed, Enum.EasingStyle.Linear, Enum.EasingDirection.InOut)
    local tween = TweenService:Create(humanoidRootPart, tweenInfo, { CFrame = Pos })

    tween:Play()

    if Distance <= 10 then
        tween:Cancel()
        humanoidRootPart.CFrame = Pos
    end

    if getgenv().StopTween then
        tween:Cancel()
        getgenv().StopTween = false
    end
end

local function setupRemoteEvents()
    local adminRemote = ReplicatedStorage:FindFirstChild("AdminPanelRemote")
    if not adminRemote then
        adminRemote = Instance.new("RemoteEvent")
        adminRemote.Name = "AdminPanelRemote"
        adminRemote.Parent = ReplicatedStorage
    end
    
    local adminBindable = ReplicatedStorage:FindFirstChild("AdminPanelBindable")
    if not adminBindable then
        adminBindable = Instance.new("BindableEvent")
        adminBindable.Name = "AdminPanelBindable"
        adminBindable.Parent = ReplicatedStorage
    end
    
    return adminRemote, adminBindable
end

local adminRemote, adminBindable = setupRemoteEvents()

local function broadcastCommand(command, targetName, additionalData)
    pcall(function()
        processCommand({
            command = command,
            target = targetName,
            sender = LocalPlayer.Name,
            data = additionalData or {}
        })
    end)
    
    pcall(function()
        adminRemote:FireServer({
            command = command,
            target = targetName,
            sender = LocalPlayer.Name,
            data = additionalData or {}
        })
    end)
    
    pcall(function()
        adminBindable:Fire({
            command = command,
            target = targetName,
            sender = LocalPlayer.Name,
            data = additionalData or {}
        })
    end)
end

function processCommand(commandData)
    if not commandData then return end
    
    local command = commandData.command
    local targetName = commandData.target
    local senderName = commandData.sender
    local data = commandData.data or {}
    
    local targetPlayer = Players:FindFirstChild(targetName)
    local senderPlayer = Players:FindFirstChild(senderName)
    if not targetPlayer then return end
    
    local canExecute = false
    
    if targetPlayer == LocalPlayer then
        canExecute = true
    end

    if allowedUsers[senderName] then
        canExecute = true
    end
    
    if not canExecute then return end
    
    if command == "jail" then
        CreateJail(targetPlayer, true)
    elseif command == "unjail" then
        RemoveJail(targetPlayer, true)
    elseif command == "freeze" then
        if FrozenPlayers[targetPlayer] then
            UnfreezePlayer(targetPlayer, true)
        else
            FreezePlayer(targetPlayer, true)
        end
    elseif command == "kill" and targetPlayer == LocalPlayer then
        local hum = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildWhichIsA("Humanoid")
        if hum then hum.Health = 0 end
    elseif command == "kick" and targetPlayer == LocalPlayer then
        LocalPlayer:Kick("Você foi expulso pelo painel de admin por " .. senderName)
    elseif command == "sharingan" and targetPlayer == LocalPlayer then
        ExecuteSharingan()
    elseif command == "bring" and targetPlayer == LocalPlayer then
        -- O LocalPlayer (alvo) será trazido para perto do sender
        local senderPlayer = Players:FindFirstChild(senderName)
        if senderPlayer and senderPlayer.Character and senderPlayer.Character:FindFirstChild("HumanoidRootPart") then
            local targetChar = LocalPlayer.Character
            if targetChar and targetChar:FindFirstChild("HumanoidRootPart") then
                local targetHRP = targetChar.HumanoidRootPart
                local senderHRP = senderPlayer.Character.HumanoidRootPart
                targetHRP.CFrame = senderHRP.CFrame + Vector3.new(0, 1, 0)
            end
        end
    end
end

adminRemote.OnClientEvent:Connect(function(commandData)
    processCommand(commandData)
end)

adminBindable.Event:Connect(function(commandData)
    processCommand(commandData)
end)

function ToggleGravity(player)
    if player ~= LocalPlayer then return end -- Só executa se EU sou o alvo
    
    local character = LocalPlayer.Character
    if not character then return end
    
    if gravityDisabled[LocalPlayer] then
        -- Restaurar gravidade
        workspace.Gravity = 196.2
        for _, part in pairs(character:GetChildren()) do
            if part:IsA("BasePart") then
                local bodyVelocity = part:FindFirstChild("AntiGravity")
                if bodyVelocity then
                    bodyVelocity:Destroy()
                end
            end
        end
        gravityDisabled[LocalPlayer] = nil
    else
        -- Desativar gravidade
        workspace.Gravity = 0
        for _, part in pairs(character:GetChildren()) do
            if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
                local bodyVelocity = Instance.new("BodyVelocity")
                bodyVelocity.Name = "AntiGravity"
                bodyVelocity.MaxForce = Vector3.new(0, math.huge, 0)
                bodyVelocity.Velocity = Vector3.new(0, 0, 0)
                bodyVelocity.Parent = part
            end
        end
        gravityDisabled[LocalPlayer] = true
    end
end

function CreateChaosClones(player)
    if player ~= LocalPlayer then return end -- Só executa se EU sou o alvo
    
    local character = LocalPlayer.Character
    if not character or clonedPlayers[LocalPlayer] then return end
    
    clonedPlayers[LocalPlayer] = {}
    
    for i = 1, 5 do
        local clone = character:Clone()
        clone.Name = LocalPlayer.Name .. "_Clone_" .. i
        clone.Parent = workspace
        
        -- Remove scripts do clone
        for _, obj in pairs(clone:GetDescendants()) do
            if obj:IsA("Script") or obj:IsA("LocalScript") then
                obj:Destroy()
            end
        end
        
        -- Posição randômica
        local HRP = clone:FindFirstChild("HumanoidRootPart")
        if HRP then
            HRP.CFrame = character.HumanoidRootPart.CFrame + Vector3.new(
                math.random(-10, 10),
                math.random(0, 5),
                math.random(-10, 10)
            )
            
            -- Movimento caótico
            spawn(function()
                while clone.Parent do
                    wait(math.random(1, 3))
                    if HRP.Parent then
                        local randomPos = HRP.CFrame + Vector3.new(
                            math.random(-20, 20),
                            math.random(-5, 5),
                            math.random(-20, 20)
                        )
                        HRP.CFrame = randomPos
                    end
                end
            end)
        end
        
        table.insert(clonedPlayers[LocalPlayer], clone)
        
        -- Remove clone após 30 segundos
        game:GetService("Debris"):AddItem(clone, 30)
    end
    
    -- Reset após 35 segundos
    spawn(function()
        wait(35)
        clonedPlayers[LocalPlayer] = nil
    end)
end

function ActivateGlitchMode(player)
    if player ~= LocalPlayer then return end -- Só executa se EU sou o alvo
    if glitchActive[LocalPlayer] then return end
    
    glitchActive[LocalPlayer] = true
    
    local gui = Instance.new("ScreenGui")
    gui.Name = "GlitchEffect"
    gui.Parent = LocalPlayer:WaitForChild("PlayerGui")
    
    local glitchFrame = Instance.new("Frame")
    glitchFrame.Size = UDim2.new(1, 0, 1, 0)
    glitchFrame.Position = UDim2.new(0, 0, 0, 0)
    glitchFrame.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
    glitchFrame.BackgroundTransparency = 0.8
    glitchFrame.Parent = gui
    
    local glitchEffect = Instance.new("ImageLabel")
    glitchEffect.Size = UDim2.new(1, 0, 1, 0)
    glitchEffect.Position = UDim2.new(0, 0, 0, 0)
    glitchEffect.BackgroundTransparency = 1
    glitchEffect.Image = "rbxasset://textures/ui/ErrorIcon.png"
    glitchEffect.ImageTransparency = 0.3
    glitchEffect.ScaleType = Enum.ScaleType.Tile
    glitchEffect.TileSize = UDim2.new(0, 50, 0, 50)
    glitchEffect.Parent = glitchFrame
    
    -- Efeito piscante
    spawn(function()
        for i = 1, 50 do
            if not glitchFrame.Parent then break end
            glitchFrame.BackgroundColor3 = Color3.fromRGB(
                math.random(0, 255),
                math.random(0, 255),
                math.random(0, 255)
            )
            glitchFrame.Position = UDim2.new(
                math.random(-10, 10) / 1000,
                0,
                math.random(-10, 10) / 1000,
                0
            )
            wait(0.1)
        end
        
        gui:Destroy()
        glitchActive[LocalPlayer] = nil
    end)
end

function ActivateShapeshift(player)
    if player ~= LocalPlayer then return end -- Só executa se EU sou o alvo
    if shapeshiftActive[LocalPlayer] then return end
    
    shapeshiftActive[LocalPlayer] = true
    
    local character = LocalPlayer.Character
    if not character then return end
    
    -- Lista de formas estranhas
    local shapes = {
        Vector3.new(0.1, 10, 0.1), -- Palito
        Vector3.new(5, 0.1, 5),    -- Panqueca
        Vector3.new(8, 8, 8),      -- Cubo gigante
        Vector3.new(0.5, 0.5, 15), -- Salsicha
    }
    
    local randomShape = shapes[math.random(1, #shapes)]
    
    -- Transformar todas as partes
    for _, part in pairs(character:GetChildren()) do
        if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
            part.Size = randomShape
            part.Color = Color3.fromRGB(
                math.random(0, 255),
                math.random(0, 255),
                math.random(0, 255)
            )
            part.Material = Enum.Material.Neon
        end
    end
    
    -- Restaurar após 15 segundos
    spawn(function()
        wait(15)
        if character.Parent then
            -- Restaurar forma original (aproximada)
            for _, part in pairs(character:GetChildren()) do
                if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
                    part.Size = Vector3.new(1, 1, 1) -- Tamanho padrão
                    part.Color = Color3.fromRGB(163, 162, 165) -- Cor padrão
                    part.Material = Enum.Material.Plastic
                end
            end
        end
        shapeshiftActive[LocalPlayer] = nil
    end)
end

function ExecuteSharingan()
    -- CORREÇÃO: Proteção contra execução múltipla
    if sharinganRunning then
        return
    end
    
    sharinganRunning = true
    
    local Sound = Instance.new("Sound",game:GetService("SoundService"))
    Sound.SoundId = "rbxassetid://1592708450"
    Sound:Play()
    local Intro = Instance.new("ScreenGui")
    local Logo = Instance.new("ImageLabel")
    local Circle = Instance.new("UICorner")

    Intro.Name = "Intro"
    Intro.Parent = LocalPlayer:WaitForChild("PlayerGui")
    Intro.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

    Logo.Name = "Logo"
    Logo.Parent = Intro
    Logo.AnchorPoint = Vector2.new(0.5, 0.5)
    Logo.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    Logo.BackgroundTransparency = 1.000
    Logo.BorderColor3 = Color3.fromRGB(0, 0, 0)
    Logo.BorderSizePixel = 0
    Logo.Position = UDim2.new(0.5, 0, 0.5, 0)
    Logo.Size = UDim2.new(0, 0, 0, 0)
    Logo.Image = "rbxassetid://114416257899946"
    Logo.ImageTransparency = 0
    Logo.ScaleType = Enum.ScaleType.Crop

    Circle.CornerRadius = UDim.new(0.5, 0)
    Circle.Name = "Circle"
    Circle.Parent = Logo

    local tweenInfo = TweenInfo.new(1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)

    local sizeTween = TweenService:Create(Logo, tweenInfo, {Size = UDim2.new(0, 400, 0, 400)})
    local rotationTween = TweenService:Create(Logo, tweenInfo, {Rotation = 360})

    sizeTween:Play()
    rotationTween:Play()

    task.wait(3) 

    Logo:TweenSizeAndPosition(
        UDim2.new(0, 0, 0, 0), 
        UDim2.new(0.5, 0, 0.5, 0), 
        Enum.EasingDirection.Out,
        Enum.EasingStyle.Quad, 2,
        true,
        function()
            Intro:Destroy()
            sharinganRunning = false -- Reset da proteção quando terminar
        end
    )
end

function CreateJail(player, fromBroadcast)
    if JailObjects[player] then return end
    
    local character = player.Character
    if character and character:FindFirstChild("HumanoidRootPart") then
        local HRP = character.HumanoidRootPart
        
        local cageSize = Vector3.new(10, 10, 10)
        local wallThickness = 0.5
        local transparency = 0.3
        local cageColor = Color3.fromRGB(75, 0, 130)

        local cageModel = Instance.new("Model")
        cageModel.Name = "JaulaDeAdmin_" .. player.Name
        cageModel.Parent = workspace

        local function createWall(size, positionOffset)
            local wall = Instance.new("Part")
            wall.Size = size
            wall.Anchored = true
            wall.CanCollide = true
            wall.Transparency = transparency
            wall.Color = cageColor
            wall.Material = Enum.Material.ForceField
            wall.CFrame = HRP.CFrame * positionOffset
            wall.Parent = cageModel
            
            local stroke = Instance.new("SelectionBox")
            stroke.Color3 = Color3.fromRGB(147, 112, 219)
            stroke.LineThickness = 0.2
            stroke.Transparency = 0.5
            stroke.Adornee = wall
            stroke.Parent = wall
        end

        createWall(Vector3.new(cageSize.X, wallThickness, cageSize.Z), CFrame.new(0, -cageSize.Y/2, 0))
        createWall(Vector3.new(cageSize.X, wallThickness, cageSize.Z), CFrame.new(0, cageSize.Y/2, 0))
        createWall(Vector3.new(cageSize.X, cageSize.Y, wallThickness), CFrame.new(0, 0, -cageSize.Z/2))
        createWall(Vector3.new(cageSize.X, cageSize.Y, wallThickness), CFrame.new(0, 0, cageSize.Z/2))
        createWall(Vector3.new(wallThickness, cageSize.Y, cageSize.Z), CFrame.new(cageSize.X/2, 0, 0))

        createWall(Vector3.new(wallThickness, cageSize.Y, cageSize.Z), CFrame.new(-cageSize.X/2, 0, 0))

        JailObjects[player] = cageModel
        
        spawn(function()
            while JailObjects[player] and player.Parent do
                task.wait(0.5)
                if character and character:FindFirstChild("HumanoidRootPart") then
                    local currentHRP = character.HumanoidRootPart
                    local distance = (currentHRP.Position - HRP.Position).Magnitude
                    if distance > 8 then
                        currentHRP.CFrame = HRP.CFrame
                    end
                end
            end
        end)
    end
end

function RemoveJail(player, fromBroadcast)
    if JailObjects[player] then
        JailObjects[player]:Destroy()
        JailObjects[player] = nil
    end
end

function FreezePlayer(player, fromBroadcast)
    if FrozenPlayers[player] then return end
    
    local character = player.Character
    if character then
        local humanoid = character:FindFirstChildOfClass("Humanoid")
        if humanoid then
            humanoid.WalkSpeed = 0
            humanoid.JumpPower = 0
            humanoid.JumpHeight = 0
        end

        for _, part in pairs(character:GetChildren()) do
            if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
                part.Anchored = true
            end
        end
        
        local HRP = character:FindFirstChild("HumanoidRootPart")
        if HRP then
            HRP.Anchored = true
        end
        
        FrozenPlayers[player] = {
            originalWalkSpeed = humanoid and humanoid.WalkSpeed or 16,
            originalJumpPower = humanoid and humanoid.JumpPower or 50,
            originalJumpHeight = humanoid and humanoid.JumpHeight or 7.2,
            humanoid = humanoid,
            hrp = HRP,
            character = character
        }
        
        local iceEffect = Instance.new("Part")
        iceEffect.Name = "IceEffect_" .. player.Name
        iceEffect.Size = character:GetExtentsSize() + Vector3.new(1, 1, 1)
        iceEffect.CFrame = HRP.CFrame
        iceEffect.Anchored = true
        iceEffect.CanCollide = false
        iceEffect.Transparency = 0.5
        iceEffect.Color = Color3.fromRGB(173, 216, 230)
        iceEffect.Material = Enum.Material.Ice
        iceEffect.Parent = workspace
        
        FrozenPlayers[player].iceEffect = iceEffect
        
        spawn(function()
            while FrozenPlayers[player] and player.Parent do
                task.wait(0.1)
                local char = player.Character
                if char then
                    local hum = char:FindFirstChildOfClass("Humanoid")
                    if hum then
                        hum.WalkSpeed = 0
                        hum.JumpPower = 0
                        hum.JumpHeight = 0
                    end
                    
                    for _, part in pairs(char:GetChildren()) do
                        if part:IsA("BasePart") then
                            part.Anchored = true
                        end
                    end
                end
            end
        end)
    end
end

function UnfreezePlayer(player, fromBroadcast)
    if FrozenPlayers[player] then
        local data = FrozenPlayers[player]
        
        if data.humanoid and data.humanoid.Parent then
            data.humanoid.WalkSpeed = data.originalWalkSpeed or 16
            data.humanoid.JumpPower = data.originalJumpPower or 50
            data.humanoid.JumpHeight = data.originalJumpHeight or 7.2
        end
        
        if data.character and data.character.Parent then
            for _, part in pairs(data.character:GetChildren()) do
                if part:IsA("BasePart") then
                    part.Anchored = false
                end
            end
        end
        
        if data.iceEffect then
            data.iceEffect:Destroy()
        end
        
        FrozenPlayers[player] = nil
    end
end

if allowedUsers[LocalPlayer.Name] then
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "AdminPanelGUI"
    ScreenGui.Parent = PlayerGui
    ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

    local MainFrame = Instance.new("Frame")
    MainFrame.Size = UDim2.new(0, 350, 0, 730)
    MainFrame.Position = UDim2.new(0.5, -175, 0.5, -365)
    MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    MainFrame.BackgroundTransparency = 0.1
    MainFrame.BorderSizePixel = 0
    MainFrame.ClipsDescendants = true
    MainFrame.Active = true
    MainFrame.Selectable = true
    MainFrame.Draggable = true
    MainFrame.Parent = ScreenGui

    local gradient = Instance.new("UIGradient")
    gradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.fromRGB(75, 0, 130)),
        ColorSequenceKeypoint.new(0.5, Color3.fromRGB(106, 90, 205)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(123, 104, 238))
    }
    gradient.Rotation = 45
    gradient.Parent = MainFrame

    local UICornerMain = Instance.new("UICorner")
    UICornerMain.CornerRadius = UDim.new(0, 15)
    UICornerMain.Parent = MainFrame

    local MainStroke = Instance.new("UIStroke")
    MainStroke.Color = Color3.fromRGB(147, 112, 219)
    MainStroke.Thickness = 3
    MainStroke.Transparency = 0.3
    MainStroke.Parent = MainFrame

    local InnerGlow = Instance.new("Frame")
    InnerGlow.Size = UDim2.new(1, -6, 1, -6)
    InnerGlow.Position = UDim2.new(0, 3, 0, 3)
    InnerGlow.BackgroundTransparency = 1
    InnerGlow.Parent = MainFrame

    local InnerStroke = Instance.new("UIStroke")
    InnerStroke.Color = Color3.fromRGB(255, 255, 255)
    InnerStroke.Thickness = 1
    InnerStroke.Transparency = 0.7
    InnerStroke.Parent = InnerGlow

    local InnerCorner = Instance.new("UICorner")
    InnerCorner.CornerRadius = UDim.new(0, 12)
    InnerCorner.Parent = InnerGlow

    local Title = Instance.new("TextLabel")
    Title.Size = UDim2.new(1, 0, 0, 50)
    Title.Position = UDim2.new(0, 0, 0, 0)
    Title.BackgroundTransparency = 1
    Title.Text = "PAINEL DE ADMIN"
    Title.Font = Enum.Font.GothamBold
    Title.TextSize = 16
    Title.TextColor3 = Color3.fromRGB(255, 255, 255)
    Title.TextStrokeTransparency = 0
    Title.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
    Title.TextYAlignment = Enum.TextYAlignment.Center
    Title.Parent = MainFrame

    local Line = Instance.new("Frame")
    Line.Size = UDim2.new(0.8, 0, 0, 2)
    Line.Position = UDim2.new(0.1, 0, 0, 50)
    Line.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    Line.BackgroundTransparency = 0.3
    Line.BorderSizePixel = 0
    Line.Parent = MainFrame

    local LineCorner = Instance.new("UICorner")
    LineCorner.CornerRadius = UDim.new(1, 0)
    LineCorner.Parent = Line
    
    local ScrollingFrame = Instance.new("ScrollingFrame")
    ScrollingFrame.Size = UDim2.new(1, -20, 1, -70)
    ScrollingFrame.Position = UDim2.new(0, 10, 0, 60)
    ScrollingFrame.CanvasSize = UDim2.new(0, 0, 0, 700)
    ScrollingFrame.ScrollBarThickness = 8
    ScrollingFrame.BackgroundTransparency = 1
    ScrollingFrame.ZIndex = 2
    ScrollingFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y
    ScrollingFrame.ScrollingDirection = Enum.ScrollingDirection.Y
    ScrollingFrame.ScrollBarImageColor3 = Color3.fromRGB(147, 112, 219)
    ScrollingFrame.Parent = MainFrame

    local function createButton(text, yPos, icon)
        local button = Instance.new("TextButton")
        button.Size = UDim2.new(1, -10, 0, 45)
        button.Position = UDim2.new(0, 0, 0, yPos)
        button.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
        button.BackgroundTransparency = 0.2
        button.Text = (icon or "") .. " " .. text
        button.Font = Enum.Font.GothamBold
        button.TextSize = 16
        button.TextColor3 = Color3.fromRGB(255, 255, 255)
        button.TextStrokeTransparency = 0
        button.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
        button.ZIndex = 2
        button.Parent = ScrollingFrame

        local btnGradient = Instance.new("UIGradient")
        btnGradient.Color = ColorSequence.new{
            ColorSequenceKeypoint.new(0, Color3.fromRGB(138, 43, 226)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(75, 0, 130))
        }
        btnGradient.Rotation = 90
        btnGradient.Parent = button

        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 10)
        corner.Parent = button

        local stroke = Instance.new("UIStroke")
        stroke.Color = Color3.fromRGB(147, 112, 219)
        stroke.Thickness = 2
        stroke.Transparency = 0.5
        stroke.Parent = button

        button.MouseEnter:Connect(function()
            local hoverTween = TweenService:Create(button, TweenInfo.new(0.2), {
                BackgroundTransparency = 0
            })
            local strokeTween = TweenService:Create(stroke, TweenInfo.new(0.2), {
                Transparency = 0.2
            })
            hoverTween:Play()
            strokeTween:Play()
        end)

        button.MouseLeave:Connect(function()
            local leaveTween = TweenService:Create(button, TweenInfo.new(0.2), {
                BackgroundTransparency = 0.2
            })
            local strokeTween = TweenService:Create(stroke, TweenInfo.new(0.2), {
                Transparency = 0.5
            })
            leaveTween:Play()
            strokeTween:Play()
        end)

        return button
    end

    local PlayerDropdown = createButton("Selecionar Jogador", 0, "")

    local DropdownScroll = Instance.new("ScrollingFrame")
    DropdownScroll.Size = UDim2.new(1, -20, 0, 120)
    DropdownScroll.Position = UDim2.new(0, 10, 0, 60)
    DropdownScroll.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    DropdownScroll.BackgroundTransparency = 0.1
    DropdownScroll.Visible = false
    DropdownScroll.ZIndex = 10
    DropdownScroll.Parent = MainFrame
    DropdownScroll.ScrollBarThickness = 6
    DropdownScroll.CanvasSize = UDim2.new(0, 0, 0, 0)
    DropdownScroll.ClipsDescendants = true
    DropdownScroll.ScrollingDirection = Enum.ScrollingDirection.Y  
    DropdownScroll.AutomaticCanvasSize = Enum.AutomaticSize.Y
    DropdownScroll.Active = true
    DropdownScroll.ScrollBarImageColor3 = Color3.fromRGB(147, 112, 219)

    local UICornerScroll = Instance.new("UICorner")
    UICornerScroll.CornerRadius = UDim.new(0, 10)
    UICornerScroll.Parent = DropdownScroll

    local DropStroke = Instance.new("UIStroke")
    DropStroke.Color = Color3.fromRGB(147, 112, 219)
    DropStroke.Thickness = 2
    DropStroke.Parent = DropdownScroll

    local KillButton = createButton("Kill Cmd;", 55, "")
    local KickButton = createButton("Kick Cmd;", 110, "")
    local BringButton = createButton("Teleport Cmd;", 165, "")
    local JailButton = createButton("Jail Cmd;", 220, "")
    local UnjailButton = createButton("Unjail Cmd;", 275, "")
    local FreezeButton = createButton("Freeze cmd;", 330, "")
    local Sharin = createButton("Sharingan Cmd", 385, "")
    local GravityButton = createButton("Gravity Cmd;", 440, "")
    local CloneButton = createButton("Clone Chaos;", 495, "")
    local GlitchButton = createButton("Glitch Mode;", 550, "")
    local ShapeshiftButton = createButton("Shapeshift;", 605, "")
    
    local function animateButton(btn)
        btn.MouseButton1Click:Connect(function()
            local originalScale = btn.Size
            local pressedScale = UDim2.new(originalScale.X.Scale * 0.95, originalScale.X.Offset * 0.95, originalScale.Y.Scale * 0.95, originalScale.Y.Offset * 0.95)

            local pressTween = TweenService:Create(btn, TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                Size = pressedScale
            })
            local releaseTween = TweenService:Create(btn, TweenInfo.new(0.2, Enum.EasingStyle.Elastic, Enum.EasingDirection.Out), {
                Size = originalScale
            })

            pressTween:Play()
            pressTween.Completed:Connect(function()
                releaseTween:Play()
            end)
        end)
    end

    for _, btn in ipairs({PlayerDropdown, KillButton, KickButton, BringButton, JailButton, UnjailButton, FreezeButton, Sharin, GravityButton, CloneButton, GlitchButton, ShapeshiftButton}) do
        animateButton(btn)
    end

    local function populateDropdown()
        for _, child in pairs(DropdownScroll:GetChildren()) do
            if child:IsA("TextButton") then child:Destroy() end
        end

        local yPos = 0
        for i, player in ipairs(Players:GetPlayers()) do
            if player ~= LocalPlayer then
                local btn = Instance.new("TextButton")
                btn.Size = UDim2.new(1, -10, 0, 30)
                btn.Position = UDim2.new(0, 5, 0, yPos)
                btn.Text = ">" .. player.Name
                btn.Font = Enum.Font.Gotham
                btn.TextSize = 14
                btn.BackgroundColor3 = Color3.fromRGB(75, 0, 130)
                btn.BackgroundTransparency = 0.3
                btn.TextColor3 = Color3.fromRGB(255, 255, 255)
                btn.ZIndex = 11
                btn.Parent = DropdownScroll

                local corner = Instance.new("UICorner")
                corner.CornerRadius = UDim.new(0, 8)
                corner.Parent = btn

                local stroke = Instance.new("UIStroke")
                stroke.Color = Color3.fromRGB(147, 112, 219)
                stroke.Thickness = 1
                stroke.Transparency = 0.6
                stroke.Parent = btn

                btn.MouseEnter:Connect(function()
                    btn.BackgroundTransparency = 0.1
                    stroke.Transparency = 0.3
                end)

                btn.MouseLeave:Connect(function()
                    btn.BackgroundTransparency = 0.3
                    stroke.Transparency = 0.6
                end)

                btn.MouseButton1Click:Connect(function()
                    selectedPlayer = player
                    PlayerDropdown.Text = " Selecionado: " .. player.Name
                    DropdownScroll.Visible = false
                end)
                
                yPos = yPos + 35
            end
        end
    end

    PlayerDropdown.MouseButton1Click:Connect(function()
        DropdownScroll.Visible = not DropdownScroll.Visible
        populateDropdown()
    end)

    KillButton.MouseButton1Click:Connect(function()
        if selectedPlayer then
            local chatChannel = TextChatService.TextChannels.RBXGeneral
            chatChannel:SendAsync(";kill " .. selectedPlayer.Name)
        end
    end)

    KickButton.MouseButton1Click:Connect(function()
        if selectedPlayer then
            local chatChannel = TextChatService.TextChannels.RBXGeneral
            chatChannel:SendAsync(";kick " .. selectedPlayer.Name)
        end
    end)

    BringButton.MouseButton1Click:Connect(function()
        if selectedPlayer then
            local chatChannel = TextChatService.TextChannels.RBXGeneral
            chatChannel:SendAsync(";tp " .. selectedPlayer.Name)
        end
    end)

    JailButton.MouseButton1Click:Connect(function()
        if selectedPlayer then
            local chatChannel = TextChatService.TextChannels.RBXGeneral
            chatChannel:SendAsync(";jail " .. selectedPlayer.Name)
        end
    end)

    UnjailButton.MouseButton1Click:Connect(function()
        if selectedPlayer then
            local chatChannel = TextChatService.TextChannels.RBXGeneral
            chatChannel:SendAsync(";unjail " .. selectedPlayer.Name)
        end
    end)

    FreezeButton.MouseButton1Click:Connect(function()
        if selectedPlayer then
            local chatChannel = TextChatService.TextChannels.RBXGeneral
            chatChannel:SendAsync(";freez " .. selectedPlayer.Name)
        end
    end)

    Sharin.MouseButton1Click:Connect(function()
        if selectedPlayer then
            local chatChannel = TextChatService.TextChannels.RBXGeneral
            chatChannel:SendAsync(";shr " .. selectedPlayer.Name)
        end
    end)

    GravityButton.MouseButton1Click:Connect(function()
        if selectedPlayer then
            local chatChannel = TextChatService.TextChannels.RBXGeneral
            chatChannel:SendAsync(";gravity " .. selectedPlayer.Name)
        end
    end)

    CloneButton.MouseButton1Click:Connect(function()
        if selectedPlayer then
            local chatChannel = TextChatService.TextChannels.RBXGeneral
            chatChannel:SendAsync(";clone " .. selectedPlayer.Name)
        end
    end)

    GlitchButton.MouseButton1Click:Connect(function()
        if selectedPlayer then
            local chatChannel = TextChatService.TextChannels.RBXGeneral
            chatChannel:SendAsync(";glitch " .. selectedPlayer.Name)
        end
    end)

    ShapeshiftButton.MouseButton1Click:Connect(function()
        if selectedPlayer then
            local chatChannel = TextChatService.TextChannels.RBXGeneral
            chatChannel:SendAsync(";shapeshift " .. selectedPlayer.Name)
        end
    end)

    local toggleGui = Instance.new("ScreenGui")
    toggleGui.Name = "ToggleGui"
    toggleGui.Parent = PlayerGui
    toggleGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    toggleGui.ResetOnSpawn = false

    local toggleButton = Instance.new("TextButton")
    toggleButton.Size = UDim2.new(0, 50, 0, 50)
    toggleButton.Position = UDim2.new(0, 15, 0.5, -25)
    toggleButton.BackgroundColor3 = Color3.fromRGB(75, 0, 130)
    toggleButton.BackgroundTransparency = 0.1
    toggleButton.Text = ""
    toggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    toggleButton.TextSize = 20
    toggleButton.Font = Enum.Font.GothamBold
    toggleButton.Parent = toggleGui

    local toggleGradient = Instance.new("UIGradient")
    toggleGradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.fromRGB(138, 43, 226)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(75, 0, 130))
    }
    toggleGradient.Parent = toggleButton

    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(1, 0)
    corner.Parent = toggleButton

    local toggleStroke = Instance.new("UIStroke")
    toggleStroke.Color = Color3.fromRGB(147, 112, 219)
    toggleStroke.Thickness = 3
    toggleStroke.Parent = toggleButton

    local panelOpen = true

    toggleButton.MouseButton1Click:Connect(function()
        local targetPos
        if panelOpen then
            targetPos = UDim2.new(0.5, -175, 1.5, 0)
        else
            targetPos = UDim2.new(0.5, -175, 0.5, -365)
        end

        local tween = TweenService:Create(MainFrame, TweenInfo.new(0.5, Enum.EasingStyle.Elastic, Enum.EasingDirection.Out), {
            Position = targetPos
        })
        tween:Play()

        panelOpen = not panelOpen
    end)

end

TextChatService.TextChannels.RBXGeneral.MessageReceived:Connect(function(message)
    local text = message.Text:lower()
    local sender = message.TextSource and Players:GetPlayerByUserId(message.TextSource.UserId)

    if not sender then return end

    local function findTarget(name)
        for _, player in ipairs(Players:GetPlayers()) do
            if player.Name:lower():sub(1, #name) == name:lower() then
                return player
            end
        end
    end

    local args = {}
    for word in text:gmatch("%S+") do
        table.insert(args, word)
    end

    local cmd = args[1]
    local targetName = args[2]
    local target = targetName and findTarget(targetName)
    
    -- Permite que qualquer jogador execute comandos, mas verifica permissões no processCommand
    if cmd == ";kill" and target then
        broadcastCommand("kill", target.Name)
        
    elseif cmd == ";kick" and target then
        broadcastCommand("kick", target.Name)
        
    elseif cmd == ";tp" and target then
        broadcastCommand("teleport", target.Name)
        
    elseif cmd == ";jail" and target then
        broadcastCommand("jail", target.Name)
        
    elseif cmd == ";unjail" and target then
        broadcastCommand("unjail", target.Name)
        
    elseif cmd == ";freez" and target then
        broadcastCommand("freeze", target.Name)
        
    elseif cmd == ";shr" and target then
        broadcastCommand("sharingan", target.Name)
        
    elseif cmd == ";gravity" and target then
        broadcastCommand("gravity", target.Name)
        
    elseif cmd == ";clone" and target then
        broadcastCommand("clone", target.Name)
        
    elseif cmd == ";glitch" and target then
        broadcastCommand("glitch", target.Name)
        
    elseif cmd == ";shapeshift" and target then
        broadcastCommand("shapeshift", target.Name)
    end
end)
